(()=>{"use strict";const e=class{constructor(e){this.player=e}shipPositions=[];allShotsTaken=[];missedShots=[];ships=[];previousShot=[];placeShip(e,t,o,i){let n=new class{constructor(e){this.length=e}hitCount=0;position=[];getHit=()=>this.hitCount++;isSunk=()=>this.hitCount>=this.length}(i),r=[],l=e,s=t;if(e<0||e>10||t<0||t>10)return"invalid position";r.push([e,t]);for(let n=1;n<i;n++)"x"===o?(l++,r.push([l,t])):(s++,r.push([e,s]));if(!1===this.checkPositionAvailability(r,this.shipPositions))return"invalid position";this.shipPositions=[...this.shipPositions,...r],n.position=r,this.ships.push(n)}placeRandomShips(){let e,t=0,o=[5,4,3,3,2];for(let i=0;i<o.length;i++)for(;t!==i+1;){let n=Math.floor(10*Math.random()+1),r=Math.floor(10*Math.random()+1);console.log("x: ",n),console.log("y: ",r),e=n>=5?"x":"y","invalid position"!==this.placeShip(n,r,e,o[i])&&t++}}removeShips(){for(;this.allShotsTaken.length;)this.allShotsTaken.pop();for(;this.shipPositions.length;)this.shipPositions.pop();for(;this.ships.length;)this.ships.pop();console.log(this.shipPositions)}receiveAttack(e,t){this.allShotsTaken.push([e,t]);for(let o=0;o<this.shipPositions.length;o++){let i,n;if(this.shipPositions[o][0]===e&&this.shipPositions[o][1]===t)return this.ships.forEach((o=>{o.position.forEach((r=>{r[0]===e&&r[1]===t&&(o.getHit(),i=o.isSunk(),n=o.position)}))})),console.log("is sunk: ",i),i?{outcome:"ship sunk!",shipPosition:n}:{outcome:"you hit a ship!"}}return this.missedShots.push([e,t]),{outcome:"you missed!"}}checkIfAllShipsSunk(){if(0===this.ships.length)return!1;for(let e=0;e<this.ships.length;e++)if(!this.ships[e].isSunk())return!1;return!0}checkPositionAvailability(e,t){for(let o=0;o<e.length;o++){if(e[o][0]<1||e[o][0]>10||e[o][1]<1||e[o][1]>10)return!1;for(let i=0;i<t.length;i++)if(e[o][0]-1<=t[i][0]&&t[i][0]<=e[o][0]+1&&e[o][1]-1<=t[i][1]&&t[i][1]<=e[o][1]+1)return!1}return!0}};let t=document.querySelector(".playerContainer > div"),o=document.querySelector(".opponentContainer > div"),i=document.querySelector(".startButton"),n=document.querySelector(".resetButton"),r=document.querySelector(".playAgainButton"),l="player",s=document.querySelector(".messageBoard"),c=null,u=null,a=null,d=document.querySelector(".shipContainer"),h=document.querySelector(".shipBlockMessage"),p=document.querySelector(".shipBlock"),m=document.querySelector(".shipBlockMessage2");function y(e,t){let o=0,i=0;for(o=0;o<e;o++){const n=document.createElement("div");for(n.classList.add("gridColumn"),t.appendChild(n),i=0;i<e;i++){const e=document.createElement("div");e.classList.add("gridBlock"),e.setAttribute("x",o+1),e.setAttribute("y",i+1),n.appendChild(e)}}}function f(e){document.querySelectorAll(".playerContainer > .gameboard > .gridColumn > .gridBlock").forEach((t=>{let o=Number(t.getAttribute("x")),i=Number(t.getAttribute("y"));e.forEach((e=>{e[0]!==o||e[1]!==i||t.classList.add("hasShip")}))}))}function g(e){if(0===e.ships.length){h.textContent="Click on your board to place your Carrier";let t=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div");d.append(t,o,i,n,r),b(e,5)}if(1===e.ships.length){h.textContent="Click on your board to place your Battleship";let t=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div"),n=document.createElement("div"),r=d.lastElementChild;for(;r;)d.removeChild(r),r=d.lastElementChild;d.append(t,o,i,n),b(e,4)}if(2===e.ships.length||3===e.ships.length){h.textContent="Click on your board to place your Cruiser";let t=document.createElement("div"),o=document.createElement("div"),i=document.createElement("div"),n=d.lastElementChild;for(;n;)d.removeChild(n),n=d.lastElementChild;d.append(t,o,i),b(e,3)}if(4===e.ships.length){h.textContent="Click on your board to place your Destroyer";let t=document.createElement("div"),o=document.createElement("div"),i=d.lastElementChild;for(;i;)d.removeChild(i),i=d.lastElementChild;d.append(t,o),b(e,2)}5===e.ships.length&&(p.style.display="none",h.style.display="none",m.textContent="Good luck!",i.disabled=!1)}function b(e,t){let o=document.querySelectorAll(".playerContainer > .gameboard > .gridColumn > .gridBlock");o.forEach((i=>{i.addEventListener("click",(()=>{let n=d.getAttribute("direction"),r=Number(i.getAttribute("x")),l=Number(i.getAttribute("y"));e.placeShip(r,l,n,t),f(e.shipPositions),o.forEach((e=>{e.replaceWith(e.cloneNode(!0))})),g(e)}))}))}function C(){return"player"===l?s.textContent="Your turn to play":"opponent"===l?s.textContent="Opponent's turn to play":void 0}function S(){return function(){let e=document.querySelectorAll(".opponentContainer > .gameboard > .gridColumn > .gridBlock"),t=document.querySelectorAll(".playerContainer > .gameboard > .gridColumn > .gridBlock");e.forEach((e=>{e.style.cursor="default",e.replaceWith(e.cloneNode(!0))})),t.forEach((e=>{e.style.cursor="default",e.replaceWith(e.cloneNode(!0))}))}(),i.style.display="none",n.style.display="none",r.style.display="block",s.textContent="player"===l?"All of your opponent's ships went down, you won!":"All of your ships went down, you lost!"}function k(e,t){let o,i;console.log("current turn: ",l),"player"===l?(o=document.querySelectorAll(".opponentContainer > .gameboard > .gridColumn > .gridBlock"),i=t):(o=document.querySelectorAll(".playerContainer > .gameboard > .gridColumn > .gridBlock"),i=e),o.forEach((n=>{""===n.textContent&&n.addEventListener("click",(()=>{let r=Number(n.getAttribute("x")),s=Number(n.getAttribute("y")),c=i.receiveAttack(r,s);console.log(c),"you missed!"===c.outcome&&(n.textContent="●",n.style.background="#f2f4f8",n.style.cursor="default",l="player"===l?"opponent":"player",C(),o.forEach((e=>{e.replaceWith(e.cloneNode(!0))})),k(e,t)),"you hit a ship!"!==c.outcome&&"ship sunk!"!==c.outcome||(n.textContent="❌",n.style.cursor="default",n.replaceWith(n.cloneNode(!0)),o.forEach((e=>{let t=Number(e.getAttribute("x")),o=Number(e.getAttribute("y"));t!==r-1&&t!==r+1||o!==s-1&&o!==s+1||(e.textContent="●",e.style.background="#f2f4f8",e.style.cursor="default",e.replaceWith(e.cloneNode(!0)))})),"ship sunk!"===c.outcome&&(c.shipPosition.forEach((e=>{o.forEach((t=>{let o=Number(t.getAttribute("x")),i=Number(t.getAttribute("y"));e[0]-1<=o&&o<=e[0]+1&&e[1]-1<=i&&i<=e[1]+1&&!t.classList.contains("hasShip")&&(t.textContent="●",t.style.background="#f2f4f8",t.style.cursor="default",t.replaceWith(t.cloneNode(!0)))}))})),i.checkIfAllShipsSunk()&&S())),n.replaceWith(n.cloneNode(!0))}))})),"opponent"===l&&A(o,i)}function E(e){if("opponent"===l){let t=[];return e.forEach((e=>{let o=Number(e.getAttribute("x")),i=Number(e.getAttribute("y"));""===e.textContent&&t.push(JSON.stringify([o,i]))})),t}}function v(e){let t=[],o=Number(e.getAttribute("x")),i=Number(e.getAttribute("y"));return t.push(JSON.stringify([o+1,i])),t.push(JSON.stringify([o,i+1])),t.push(JSON.stringify([o-1,i])),t.push(JSON.stringify([o,i-1])),t}function A(e,t){let o;if(e.forEach((t=>{if("❌"===t.textContent)return console.log("squares around: ",v(t)),console.log("getAvailableSquares: ",E(e)),void v(t).forEach((t=>{if(console.log("getAvailableSquares(board).includes(position): ",E(e).includes(t)),E(e).includes(t))return u=JSON.parse(t)[0],a=JSON.parse(t)[1],void e.forEach((e=>{let t=Number(e.getAttribute("x")),o=Number(e.getAttribute("y"));if(t===u&&o===a)return e.click(),void(c=e)}))}))})),o=JSON.parse(E(e)[Math.floor(Math.random()*E(e).length)]),e.forEach((e=>{let t=Number(e.getAttribute("x")),i=Number(e.getAttribute("y"));if(t===o[0]&&i===o[1])return e.click(),void(c=e)})),t.checkIfAllShipsSunk())return l="opponent",void S();"❌"===c.textContent&&A(e,t)}d.addEventListener("click",(()=>{if("y"===d.getAttribute("direction"))return d.setAttribute("direction","x"),void(d.style.display="flex");d.setAttribute("direction","y"),d.style.display="block"}));let N=new e("Player"),x=new e("Computer");y(10,t),y(10,o),g(N,N.shipPositions),i.addEventListener("click",(()=>{var e,t,o,l,s;x.placeRandomShips(),document.querySelectorAll(".opponentContainer > .gameboard > .gridColumn > .gridBlock").forEach((e=>{e.classList.contains("hasShip")&&e.classList.toggle("showShip")})),e=N.shipPositions,t=x.shipPositions,o=N,l=x,m.style.display="none",i.style.display="none",n.style.display="block",r.style.display="none",f(e),s=t,document.querySelectorAll(".opponentContainer > .gameboard > .gridColumn > .gridBlock").forEach((e=>{let t=Number(e.getAttribute("x")),o=Number(e.getAttribute("y"));s.forEach((i=>{i[0]!==t||i[1]!==o||e.classList.add("hasShip")}))})),C(),k(o,l)})),n.addEventListener("click",(()=>{location.reload()})),r.addEventListener("click",(()=>{location.reload()}))})();